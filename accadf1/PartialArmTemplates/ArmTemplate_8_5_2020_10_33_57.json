{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "accadf1"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/concurrencytest')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "dataflow1",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "parquetconcurency",
								"type": "DataFlowReference",
								"parameters": {
									"param1": {
										"value": "'@{\"123\"}'",
										"type": "Expression"
									}
								}
							},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							}
						}
					}
				],
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/dataflows/parquetconcurency')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/parquetconcurency')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Parquet1incoming",
								"type": "DatasetReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "accdeltaoutput",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tparam1 as string\n}\nsource(output(\n\t\tasset as string,\n\t\tasset_tag as string,\n\t\tassigned as string,\n\t\tassigned_to as string,\n\t\tassignment_group as string,\n\t\tattributes as string,\n\t\tcan_print as string,\n\t\tcategory as string,\n\t\tcd_rom as string,\n\t\tcd_speed as string,\n\t\tchange_control as string,\n\t\tchassis_type as string,\n\t\tchecked_in as string,\n\t\tchecked_out as string,\n\t\tclassification as string,\n\t\tcomments as string,\n\t\tcompany as string,\n\t\tcorrelation_id as string,\n\t\tcost as string,\n\t\tcost_cc as string,\n\t\tcost_center as string,\n\t\tcpu_core_count as string,\n\t\tcpu_core_thread as string,\n\t\tcpu_count as string,\n\t\tcpu_manufacturer as string,\n\t\tcpu_name as string,\n\t\tcpu_speed as string,\n\t\tcpu_type as string,\n\t\tdefault_gateway as string,\n\t\tdelivery_date as string,\n\t\tdepartment as string,\n\t\tdiscovery_source as string,\n\t\tdisk_space as string,\n\t\tdns_domain as string,\n\t\tdr_backup as string,\n\t\tdue as string,\n\t\tdue_in as string,\n\t\tfault_count as string,\n\t\tfirewall_status as string,\n\t\tfirst_discovered as string,\n\t\tfloppy as string,\n\t\tform_factor as string,\n\t\tfqdn as string,\n\t\tgl_account as string,\n\t\thardware_status as string,\n\t\thardware_substatus as string,\n\t\thost_name as string,\n\t\tinstall_date as string,\n\t\tinstall_status as string,\n\t\tinvoice_number as string,\n\t\tip_address as string,\n\t\tjustification as string,\n\t\tlast_discovered as string,\n\t\tlease_id as string,\n\t\tlocation as string,\n\t\tmac_address as string,\n\t\tmaintenance_schedule as string,\n\t\tmanaged_domain as string,\n\t\tmanufacturer as string,\n\t\tmodel_id as string,\n\t\tmodel_number as string,\n\t\tname as string,\n\t\tobject_id as string,\n\t\toperational_status as string,\n\t\torder_date as string,\n\t\tos as string,\n\t\tos_address_width as string,\n\t\tos_domain as string,\n\t\tos_service_pack as string,\n\t\tos_version as string,\n\t\towned_by as string,\n\t\tpo_number as string,\n\t\tprocessor_name as string,\n\t\tpurchase_date as string,\n\t\tram as string,\n\t\tschedule as string,\n\t\tserial_number as string,\n\t\tshort_description as string,\n\t\tskip_sync as string,\n\t\tstart_date as string,\n\t\tsubcategory as string,\n\t\tsupport_group as string,\n\t\tsupported_by as string,\n\t\tsys_class_name as string,\n\t\tsys_class_path as string,\n\t\tsys_created_by as string,\n\t\tsys_created_on as string,\n\t\tsys_domain as string,\n\t\tsys_domain_path as string,\n\t\tsys_id as string,\n\t\tsys_mod_count as string,\n\t\tsys_updated_by as string,\n\t\tsys_updated_on as string,\n\t\tu_additional_attributes as string,\n\t\tu_application_id as string,\n\t\tu_asset_id as string,\n\t\tu_asset_owner as string,\n\t\tu_business_approver_groups as string,\n\t\tu_business_approvers as string,\n\t\tu_cab_approver_groups as string,\n\t\tu_cab_approvers as string,\n\t\tu_category as string,\n\t\tu_ci_manager as string,\n\t\tu_corporate_structure as string,\n\t\tu_corporatestructure1 as string,\n\t\tu_delivery_date as string,\n\t\tu_device_type as string,\n\t\tu_hardware_operating_system as string,\n\t\tu_hardware_os_version as string,\n\t\tu_managed_by_group as string,\n\t\tu_rack as string,\n\t\tu_refresh_due_date as string,\n\t\tu_room as string,\n\t\tu_site_support_team as string,\n\t\tu_start_tool_last_modified_by as string,\n\t\tu_start_tool_last_modified_date as string,\n\t\tu_support_model as string,\n\t\tu_support_model_management as string,\n\t\tu_technical_approver_groups as string,\n\t\tu_technical_approvers as string,\n\t\tunverified as string,\n\t\tused_for as string,\n\t\tvendor as string,\n\t\tvirtual as string,\n\t\twarranty_expiration as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> source1\nsource1 select(mapColumn(\n\t\teach(match(/* All input columns */ true()),\n\t\t\t/* Input name */ $$ = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 alterRow(updateIf(equals(sys_id,$param1))) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tcontainer: 'parquetoutput',\n\ttruncate: false,\n\tvacuum: 0,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/Parquet1incoming')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Parquet1incoming')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "accoutput",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileSystem": "parquetincoming"
					},
					"compressionCodec": "snappy"
				},
				"schema": [
					{
						"name": "asset",
						"type": "UTF8"
					},
					{
						"name": "asset_tag",
						"type": "UTF8"
					},
					{
						"name": "assigned",
						"type": "UTF8"
					},
					{
						"name": "assigned_to",
						"type": "UTF8"
					},
					{
						"name": "assignment_group",
						"type": "UTF8"
					},
					{
						"name": "attributes",
						"type": "UTF8"
					},
					{
						"name": "can_print",
						"type": "UTF8"
					},
					{
						"name": "category",
						"type": "UTF8"
					},
					{
						"name": "cd_rom",
						"type": "UTF8"
					},
					{
						"name": "cd_speed",
						"type": "UTF8"
					},
					{
						"name": "change_control",
						"type": "UTF8"
					},
					{
						"name": "chassis_type",
						"type": "UTF8"
					},
					{
						"name": "checked_in",
						"type": "UTF8"
					},
					{
						"name": "checked_out",
						"type": "UTF8"
					},
					{
						"name": "classification",
						"type": "UTF8"
					},
					{
						"name": "comments",
						"type": "UTF8"
					},
					{
						"name": "company",
						"type": "UTF8"
					},
					{
						"name": "correlation_id",
						"type": "UTF8"
					},
					{
						"name": "cost",
						"type": "UTF8"
					},
					{
						"name": "cost_cc",
						"type": "UTF8"
					},
					{
						"name": "cost_center",
						"type": "UTF8"
					},
					{
						"name": "cpu_core_count",
						"type": "UTF8"
					},
					{
						"name": "cpu_core_thread",
						"type": "UTF8"
					},
					{
						"name": "cpu_count",
						"type": "UTF8"
					},
					{
						"name": "cpu_manufacturer",
						"type": "UTF8"
					},
					{
						"name": "cpu_name",
						"type": "UTF8"
					},
					{
						"name": "cpu_speed",
						"type": "UTF8"
					},
					{
						"name": "cpu_type",
						"type": "UTF8"
					},
					{
						"name": "default_gateway",
						"type": "UTF8"
					},
					{
						"name": "delivery_date",
						"type": "UTF8"
					},
					{
						"name": "department",
						"type": "UTF8"
					},
					{
						"name": "discovery_source",
						"type": "UTF8"
					},
					{
						"name": "disk_space",
						"type": "UTF8"
					},
					{
						"name": "dns_domain",
						"type": "UTF8"
					},
					{
						"name": "dr_backup",
						"type": "UTF8"
					},
					{
						"name": "due",
						"type": "UTF8"
					},
					{
						"name": "due_in",
						"type": "UTF8"
					},
					{
						"name": "fault_count",
						"type": "UTF8"
					},
					{
						"name": "firewall_status",
						"type": "UTF8"
					},
					{
						"name": "first_discovered",
						"type": "UTF8"
					},
					{
						"name": "floppy",
						"type": "UTF8"
					},
					{
						"name": "form_factor",
						"type": "UTF8"
					},
					{
						"name": "fqdn",
						"type": "UTF8"
					},
					{
						"name": "gl_account",
						"type": "UTF8"
					},
					{
						"name": "hardware_status",
						"type": "UTF8"
					},
					{
						"name": "hardware_substatus",
						"type": "UTF8"
					},
					{
						"name": "host_name",
						"type": "UTF8"
					},
					{
						"name": "install_date",
						"type": "UTF8"
					},
					{
						"name": "install_status",
						"type": "UTF8"
					},
					{
						"name": "invoice_number",
						"type": "UTF8"
					},
					{
						"name": "ip_address",
						"type": "UTF8"
					},
					{
						"name": "justification",
						"type": "UTF8"
					},
					{
						"name": "last_discovered",
						"type": "UTF8"
					},
					{
						"name": "lease_id",
						"type": "UTF8"
					},
					{
						"name": "location",
						"type": "UTF8"
					},
					{
						"name": "mac_address",
						"type": "UTF8"
					},
					{
						"name": "maintenance_schedule",
						"type": "UTF8"
					},
					{
						"name": "managed_domain",
						"type": "UTF8"
					},
					{
						"name": "manufacturer",
						"type": "UTF8"
					},
					{
						"name": "model_id",
						"type": "UTF8"
					},
					{
						"name": "model_number",
						"type": "UTF8"
					},
					{
						"name": "name",
						"type": "UTF8"
					},
					{
						"name": "object_id",
						"type": "UTF8"
					},
					{
						"name": "operational_status",
						"type": "UTF8"
					},
					{
						"name": "order_date",
						"type": "UTF8"
					},
					{
						"name": "os",
						"type": "UTF8"
					},
					{
						"name": "os_address_width",
						"type": "UTF8"
					},
					{
						"name": "os_domain",
						"type": "UTF8"
					},
					{
						"name": "os_service_pack",
						"type": "UTF8"
					},
					{
						"name": "os_version",
						"type": "UTF8"
					},
					{
						"name": "owned_by",
						"type": "UTF8"
					},
					{
						"name": "po_number",
						"type": "UTF8"
					},
					{
						"name": "processor_name",
						"type": "UTF8"
					},
					{
						"name": "purchase_date",
						"type": "UTF8"
					},
					{
						"name": "ram",
						"type": "UTF8"
					},
					{
						"name": "schedule",
						"type": "UTF8"
					},
					{
						"name": "serial_number",
						"type": "UTF8"
					},
					{
						"name": "short_description",
						"type": "UTF8"
					},
					{
						"name": "skip_sync",
						"type": "UTF8"
					},
					{
						"name": "start_date",
						"type": "UTF8"
					},
					{
						"name": "subcategory",
						"type": "UTF8"
					},
					{
						"name": "support_group",
						"type": "UTF8"
					},
					{
						"name": "supported_by",
						"type": "UTF8"
					},
					{
						"name": "sys_class_name",
						"type": "UTF8"
					},
					{
						"name": "sys_class_path",
						"type": "UTF8"
					},
					{
						"name": "sys_created_by",
						"type": "UTF8"
					},
					{
						"name": "sys_created_on",
						"type": "UTF8"
					},
					{
						"name": "sys_domain",
						"type": "UTF8"
					},
					{
						"name": "sys_domain_path",
						"type": "UTF8"
					},
					{
						"name": "sys_id",
						"type": "UTF8"
					},
					{
						"name": "sys_mod_count",
						"type": "UTF8"
					},
					{
						"name": "sys_updated_by",
						"type": "UTF8"
					},
					{
						"name": "sys_updated_on",
						"type": "UTF8"
					},
					{
						"name": "u_additional_attributes",
						"type": "UTF8"
					},
					{
						"name": "u_application_id",
						"type": "UTF8"
					},
					{
						"name": "u_asset_id",
						"type": "UTF8"
					},
					{
						"name": "u_asset_owner",
						"type": "UTF8"
					},
					{
						"name": "u_business_approver_groups",
						"type": "UTF8"
					},
					{
						"name": "u_business_approvers",
						"type": "UTF8"
					},
					{
						"name": "u_cab_approver_groups",
						"type": "UTF8"
					},
					{
						"name": "u_cab_approvers",
						"type": "UTF8"
					},
					{
						"name": "u_category",
						"type": "UTF8"
					},
					{
						"name": "u_ci_manager",
						"type": "UTF8"
					},
					{
						"name": "u_corporate_structure",
						"type": "UTF8"
					},
					{
						"name": "u_corporatestructure1",
						"type": "UTF8"
					},
					{
						"name": "u_delivery_date",
						"type": "UTF8"
					},
					{
						"name": "u_device_type",
						"type": "UTF8"
					},
					{
						"name": "u_hardware_operating_system",
						"type": "UTF8"
					},
					{
						"name": "u_hardware_os_version",
						"type": "UTF8"
					},
					{
						"name": "u_managed_by_group",
						"type": "UTF8"
					},
					{
						"name": "u_rack",
						"type": "UTF8"
					},
					{
						"name": "u_refresh_due_date",
						"type": "UTF8"
					},
					{
						"name": "u_room",
						"type": "UTF8"
					},
					{
						"name": "u_site_support_team",
						"type": "UTF8"
					},
					{
						"name": "u_start_tool_last_modified_by",
						"type": "UTF8"
					},
					{
						"name": "u_start_tool_last_modified_date",
						"type": "UTF8"
					},
					{
						"name": "u_support_model",
						"type": "UTF8"
					},
					{
						"name": "u_support_model_management",
						"type": "UTF8"
					},
					{
						"name": "u_technical_approver_groups",
						"type": "UTF8"
					},
					{
						"name": "u_technical_approvers",
						"type": "UTF8"
					},
					{
						"name": "unverified",
						"type": "UTF8"
					},
					{
						"name": "used_for",
						"type": "UTF8"
					},
					{
						"name": "vendor",
						"type": "UTF8"
					},
					{
						"name": "virtual",
						"type": "UTF8"
					},
					{
						"name": "warranty_expiration",
						"type": "UTF8"
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Parquet1output')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "accoutput",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileSystem": "parquetoutput"
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": []
		}
	]
}